Router в конструкторе объявляет переменную класса - @routes массив хэшей, где будут храниться маршруты. 
Затем внутри метода init вызываеся метод класса resources(klass, keyword),который создает экземпляр переданного класса (klass) и заполняет массив хэшей @routes: ключи хэша используются для хранения типа запроса (GET,POST), а значение этого хэша используются для передачи метки вызова метода (method(:index), method(:show), method(:create)) соответствующего класса PostsController или CommentsController, переданного в klass. 
Затем в бесконечном цикле loop у пользователя запрашивается ресурс с которым он хочет работать и в зависимости от выбранного ресурса вызывает метод connection(routes) у соответствующего класса PostsController или CommentsController, передавая внутри метода вышесозданый массив хэшей @routes.
Метод connection(routes) проверяет не пуст ли переданным массив хэшей @routes, если не пуст то запрашивает у пользователя тип запроса GET,POST и вызывает через метод call вызывает соответствующий метод, метку на который мы передали в @routes в методе resources.
 

Extend, а не include используется при подмешивании модуля Resourse в класс PostController используется потому что, метод connection будет использоваться как метод класса внутри класса Router, а не экземпляра класса.
